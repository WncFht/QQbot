# NapcatBot 重构代办清单

## 第一阶段：核心框架重构

### 1. 重构 src/core 目录
- [ ] 移动现有管理器文件到对应子目录
  - [ ] `auth.py` -> `core/auth/manager.py`
  - [ ] `command_manager.py` -> `core/command/manager.py`
  - [ ] `plugin_manager.py` -> `core/plugin/manager.py`
  - [ ] `event_manager.py` -> `core/event/manager.py`
  - [ ] `bot.py` -> `core/bot/bot.py`
  - [ ] `config.py` -> `core/config/manager.py`

- [ ] 迁移数据库和日志功能到utils
  - [ ] `core/database/*` -> `utils/database/*`
  - [ ] `core/logging/*` -> `utils/logger/*`
  - [ ] `core/queue/*` -> 根据功能迁移到相应目录

- [ ] 删除冗余目录
  - [ ] 删除 `core/permission/`（整合到auth中）
  - [ ] 清理 `core/__pycache__/`

### 2. 实现核心功能模块
- [ ] Bot核心模块 (`core/bot/`)
  - [ ] 实现机器人核心类
  - [ ] 实现QQ客户端接口
  - [ ] 实现生命周期管理

- [ ] 插件系统 (`core/plugin/`)
  - [ ] 实现插件管理器
  - [ ] 实现插件加载器
  - [ ] 实现插件基类
  - [ ] 实现依赖解析系统

- [ ] 事件系统 (`core/event/`)
  - [ ] 实现事件总线
  - [ ] 实现事件处理器
  - [ ] 实现事件类型定义

- [ ] 命令系统 (`core/command/`)
  - [ ] 实现命令管理器
  - [ ] 实现命令解析器
  - [ ] 实现命令处理器

- [ ] 权限系统 (`core/auth/`)
  - [ ] 实现权限管理器
  - [ ] 实现权限定义
  - [ ] 实现角色系统

## 第二阶段：工具模块重构

### 1. 实现工具模块 (`src/utils/`)
- [ ] 配置工具
  - [ ] 实现配置管理器
  - [ ] 实现配置加载器
  - [ ] 实现配置热更新

- [ ] 数据库工具
  - [ ] 实现连接管理
  - [ ] 实现迁移工具
  - [ ] 实现备份工具

- [ ] 日志工具
  - [ ] 实现日志管理器
  - [ ] 实现日志格式化器
  - [ ] 实现日志轮转

- [ ] HTTP客户端
  - [ ] 实现请求客户端
  - [ ] 实现响应处理器

- [ ] 解析工具
  - [ ] 实现消息解析器
  - [ ] 实现命令解析器
  - [ ] 实现数据转换器

## 第三阶段：服务层和数据访问层

### 1. 实现数据访问层 (`src/repositories/`)
- [ ] 基础仓储
  - [ ] 实现基础CRUD操作
  - [ ] 实现事务支持

- [ ] 具体仓储实现
  - [ ] 消息仓储
  - [ ] 用户仓储
  - [ ] 群组仓储

### 2. 实现服务层 (`src/services/`)
- [ ] 消息服务
  - [ ] 实现消息处理
  - [ ] 实现消息分发

- [ ] 用户服务
  - [ ] 实现用户管理
  - [ ] 实现用户行为分析

- [ ] 群组服务
  - [ ] 实现群组管理
  - [ ] 实现群组活跃度分析

- [ ] 统计服务
  - [ ] 实现数据统计
  - [ ] 实现报表生成

## 第四阶段：API和插件重构

### 1. 实现API接口层 (`src/api/`)
- [ ] REST API
  - [ ] 实现基础路由
  - [ ] 实现认证授权
  - [ ] 实现API文档

- [ ] WebSocket API
  - [ ] 实现实时通信
  - [ ] 实现事件推送

### 2. 重构现有插件 (`plugins/`)
- [ ] 重构example插件
- [ ] 重构stats插件
- [ ] 重构echo插件
- [ ] 重构analyzer插件

## 第五阶段：测试和文档

### 1. 编写测试
- [ ] 单元测试
  - [ ] 核心模块测试
  - [ ] 工具模块测试
  - [ ] 服务层测试
  - [ ] 数据访问层测试

- [ ] 集成测试
  - [ ] API接口测试
  - [ ] 插件系统测试
  - [ ] 事件系统测试

### 2. 完善文档
- [ ] 编写开发文档
  - [ ] 架构说明
  - [ ] API文档
  - [ ] 插件开发指南

- [ ] 编写用户文档
  - [ ] 安装指南
  - [ ] 配置说明
  - [ ] 使用教程

## 注意事项
1. 每个阶段完成后进行代码审查
2. 保持向后兼容性
3. 遵循Python编码规范（PEP 8）
4. 及时更新文档
5. 确保测试覆盖率
